<?php

use Telegram\Bot\Api;

require '../../vendor/autoload.php';

const TOKEN = '5402169870:AAGd1B4gqLVz_1F6pLWVjh5fBVXuOadRqgw';

function sendTelegram($method, $data, $headers = [])
{
    $telegram = new Api('5402169870:AAGd1B4gqLVz_1F6pLWVjh5fBVXuOadRqgw');
    $telegram->sendMessage($data);
//    $curl = curl_init();
////    info('$method: ' . print_r($method, true));//fixme
////    info('data: ' . print_r($data, true));//fixme
//    curl_setopt_array($curl, [
//        CURLOPT_POST => 1,
//        CURLOPT_HEADER => 0,
//        CURLOPT_RETURNTRANSFER => 1,
//        CURLOPT_URL => 'https://api.telegram.org/bot' . TOKEN . '/' . $method,
//        CURLOPT_POSTFIELDS => json_encode($data),
//        CURLOPT_HTTPHEADER => array_merge(array("Content-Type: application/json;charset=utf-8", "charset: utf-8", "charset=utf-8"))
//    ]);
//    $result = curl_exec($curl);
//    curl_close($curl);
//
//    return (json_decode($result, 1) ? json_decode($result, 1) : $result);
}

$data = json_decode(file_get_contents('php://input'), TRUE);
// log input data
//info('input data: ' . print_r($data, 1));
file_put_contents(__DIR__ . '/message.txt', print_r($data, true));

$data = isset($data['callback_query']) ? $data['callback_query'] : $data['message'];

$message = mb_strtolower(($data['text'] ? $data['text'] : $data['data']), 'utf-8');

$method = 'sendMessage';

switch ($message) {
    case '/start':
        $method = 'sendMessage';
        $send_data = [
            'text' => '?? ?????? ?????? ?? ????? ?????????? ??? ???????? ? ???? ?????? ??????????:

1? ???????:
?????????????? ????? ? 4 ??????? (??????, ????, ?????, ?????) ??????????? ????????????, ?????????? ??????? ????????????.
??????? ? ??????? ?????????? ????? ? ???????????? ??????????? ????? ?????? ???????. ?????????? ? ??????????? ???-???????, ? ?????? ???????? ????? ?? ??? ?????????? ????? ???????? ?????? ??? ? ???????? ? ????-???????, ?? ????? ???????  ?????, ????? ?????, ??????? ?????????? ?? ? Apple Pay.
??????????? ????????????? ????? Master card ? ????????? ? ???????? SWIFT.
???????? ??? CREDIT ? ???????? ??? RENT CAR.
???????????? ????? ???????? ?? ????? ???????? ????? ?????, ???????? ?? ? ?????????.  ?????????  ??????????? ????? ??????????????  ? ??????? 2 ??????, ????? ???????????? ?? ??? ????? ?? ?????? (????? ???????? ??????? ?? ??????? ? ??). ??? ?????????? ????? ??????? ???? ?????????????? (?? ???????) + ??? (?????????????? ????????????????? ?????). ????????? ?????????????? ???????? ???, ??????????? ?????, ???????? ?? ??????? ??????? - 60 ??? .??????*

2? ???????:
 ?????????????? ????? ? 4 ??????? (??????, ????, ?????, ?????) ??????????? ????????????, ?????????? ??????? ???????????? ??? ??????????? ???????? ?? ????? (????????, ??????? ????? ..) 40 ??? ????????, ??? ???????? ???????? ???????? 10???.?????/????? (????? 1200-1500 ??? - ??????? ?? ????? ?????/?????). ?????? ???????????? ????? ?? ??????? ????? 30 ??? ????? (????? 4000 ?????? - ??????? ?? ????? ?????/?????).
VIP ?????, ???? ?????? ???????????? ????????, 1200 ?????? ????? ? ?????????? ?? ????? ????, ??? ??? 4%, ???????? ???? Forex ?? ???????????.
??????? ? ??????? ?????????? ????? ? ???????????? ??????????? ????? ?????? ???????. ????????? ???????? ????? ?????????????? ? ????????????? ???-????? (??????????????? ? ????????? ? ?????? ?????).
??????????? ????????????? ????? VISA ? ????????? ? ???????? SWIFT.
???????????? ????? ???????? ?? ????? ???????? ????? ?????, ???????? ?? ? ?????????.  ?????????  ??????????? ????? ??????????????  ? ??????? 2 ??????, ????? ???????????? ?? ??? ????? ?? ?????? (????? ???????? ??????? ?? ??????? ? ??). ??? ?????????? ????? ??????? ???? ?????????????? (?? ???????) + ??? (?????????????? ????????????????? ?????). ????????? ?????????????? ???????? ???, ??????????? ?????, ???????? ?? ??????? ??????? - 60 ??? .??????*

*?????? ??????? ?? 2 ???????: 50% ?????????? ? ?????? ?????????????? ????? ?????????????? ? 50% ?? ????? ???????? ?????.',
            'reply_markup' => [
                'resize_keyboard' => true,
                'keyboard' => [
                    [
                        ['text' => 'Мне подходит вариант 1'],
                    ],
                ]
            ]
        ];
        break;
    case "Мне подходит вариант 1":
        // todo ????????? ????????? ? ??????? ? ????????????
        $method = 'sendMessage';
        $send_data = [
            'html' => '<a href="https://t.me/AlternativeAssistance">??????? ?? ?????????</a>',
        ];
        break;
    default:
        $method = 'sendMessage';
        $send_data = [
            'text' => '??????? ?? ???????. ????????? ???????',
        ];
}

//$send_data['chat_id'] = 316341641;//$data['chat'] ['id'];
$send_data['chat_id'] = $data['chat'] ['id'];
$res = sendTelegram($method, $send_data);
